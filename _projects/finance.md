---
title: 금융데이터 분석
description: 개인 프로젝트
image: 금융.png
date: 2023-07-20
---

# 프로젝트 소개

금융 데이터 분석을 통한 주식 종가 예측 프로젝트를 수행했습니다.
이 프로젝트에서는 코사인 유사도와 ARIMA(Time Series Forecasting)를 활용하여 최근 우리금융지주의 주가 동향을 분석하고 예측하는 데에 주력하였습니다.

프로젝트의 기반 배경은 교육을 통해 금융 데이터에 대한 지식과 데이터 분석을 위한 통계적 기법에 대한 이해에서 비롯되었고 이를 바탕으로 주식 데이터를 분석하고 예측하는 데 필요한 통계적 방법을 익혔습니다.

프로젝트 수행에 앞서 얻은 경험들과 통계적인 지식을 바탕으로, 코사인 유사도를 활용하여 주가 데이터 간의 유사성을 평가하고, ARIMA 모델을 활용하여 
주가의 향후 추세를 예측하고자 했습니다. 

이를 통해 금융 데이터 분석에서 통계적 방법을 활용하여 주가 예측의 정확성을 향상시키는 것이 목표였습니다.
종목은 우리금융지주로 선택했습니다.

# 프로젝트 목표 및 의의

**정확한 시장 예측**

 ARIMA와 코사인 유사도를 결합함으로써, 과거의 주가 움직임과 관련된 패턴을 감지하고 이를 기반으로 미래의 주가를 예측할 수 있습니다.
이는 투자자들이 우리금융지주 주식 시장에서 미래의 흐름을 더욱 정확하게 파악할 수 있게 도와줍니다.

**투자 의사 결정에 도움**

 정확한 주가 예측은 투자자들에게 투자 의사 결정에 필요한 중요한 정보를 제공합니다.
 예측 모델을 통해 주가의 상승 또는 하락 가능성을 사전에 파악함으로써 투자자들은 미리 대응하여 투자 전략을 최적화할 수 있습니다.


**금융 시장의 불확실성 관리**

 금융 시장에서는 변동성과 불확실성이 높기 때문에, 정확한 예측은 기업이나 투자자들이 불확실성에 대응하는 데 도움이 됩니다. 
 우리금융지주 종가의 예측은 기업의 재무 계획 및 리스크 관리를 강화하는 데 도움을 줄 것으로 기대됩니다.

**기술적인 측면 강화**

 ARIMA와 코사인 유사도를 활용함으로써 데이터 분석 및 예측에 대한 기술적인 역량을 향상시키고 최신 기술을 적용하는 경험을 쌓을 수 있습니다.
 이는 향후 유사한 프로젝트나 비즈니스 응용에 대한 기반을 제공할 것입니다.

# 기간 및 참여자

 23.07~23.07 / 김태완 

# 사용 기술 및 도구

**프로그래밍 언어**: Python

**통합 개발 환경 (IDE)**: Visual Studio Code, Google Colab

# 결과물 및 성과
**코사인유사도**
![f1](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/516c9b2d-3efd-4cc9-9a35-d97f10a0946f)

데이터는 FinanceDataReader를 사용해서 우리금융지주의 23년 6월의 데이터만 불러왔습니다.

![f2](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/6c8357ec-3aed-47fb-9456-bdf1d1424dfd)

종가만 추출하여 차트를 그려봤고 그 후에 종가-최소종가 / 최대종가 – 최소종가를 하여 종가에 대한 정규화를 진행하였습니다.  
윈도우사이즈는 정규화의 길이만큼 진행했고 예측기간은 5일 (검색 횟수는 데이터의 길이 – 윈도우사이즈 – 예측기간 -1 ) 로 했습니다.

![f3](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/fcb6008d-604e-423d-a502-c6ee5a9d27d1)

코사인 유사도는 i번째 인덱스부터 i+윈도우사이즈만큼의 범위를 가져와 타겟 변수에 대입했고
종가에 대한 정규화와 마찬가지로 정규화를 적용해서 스케일을 맞춰 주었습니다.

그후 cosine_similarit함수를 이용하여 계산하였고 계산된 코사인 유사도를 추가하여 총 20개의 데이터를 뽑았고 그중에서 734번이 가장 유사도가 높아 734번으로 진행하였습니다.

오른쪽 차트는 타겟 변수에 종가 데이터의 기준 인덱스부터 기준인덱스 + 윈도웅사이즈 + 예측 5일의 데이터를 추출한 후 정규화를 적용하였습니다.  
회색 부분은 앞에서 보여드린 23년도 6월의 데이터이며 주황색 부분은 유사도가 가장 높았던 734번인 22년2월의 데이터입니다

![f4](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/c4bddcb5-847f-45dc-becb-7beb261b613e)

23년 6월 이후에도 비슷한지 확인을 위해 25일부터 7월 14일까지 데이터를 가져왔고
22년 2월부터 3월 15일까지의 데이터를 가져와본 결과 오른쪽의 붉은 원 부분을 제외하면 얼추 비슷한 모습을 보여주고 있었습니다.

![f5](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/fda8874a-ee6e-42fe-bf84-f2c19b0053a1)

이번엔 코스피 지수를 이용하여 코사인 유사도를 한번 구해봤습니다.  왼쪽은 10년부터 23년까지의 코스피지수를 추출한 것이며 오른쪽은 23년도의 코스피 지수를 차트로 표현하였습니다.

![f6](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/f1f17558-6701-4ec5-9043-ebb14d52dc67)

유사패턴을 똑같이 찾았고 표준화를 진행하여 나온 차트이며 유사한 부분을 보이고 있습니다.  
분홍색 타겟 부분은 과거의 모습을 보여주고있고 파란색 베이스의부분은 현재의 모습을 보여주고있습니다.

![f7](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/dcec3f74-6848-4cfa-9894-107423f7eb59)

23년 1월~7월까지의 데이터는 과거의 데이터는 17년도 3월부터 8월의 데이터와 유사하다고 나왔으며 17년도같은 경우는 반등을 했지만 23년 7월은 떨어지는 모습을 보여주고있습니다.
이렇게 보면 얼추 비슷하지만 완벽하게 예측을 하지 못하는 모습을 보여주고있습니다.
유사한 패턴을 하나만 가지고 예측하는 것이 바람직하지 않다고 생각했으며
패턴 검색 방식으로 주가를 예측 하고자 한다면 유사한 패턴을 많이 추출한 다음 상승 확률을 계산하느 것이 좋다고 생각했습니다.

**ARIMA**

![f8](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/eebd289b-02b4-4aa3-b449-479a5d394f2d)


![f9](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/f7b94e39-b768-43bf-8196-b0074cb234e5)


이번에도 우리금융지주의 코드를 가져와서 분석을 진행하였습니다.  **adj close**은 주식의 분할 배등 배분을 고려해 조정한 종가를 의마하며 
오른쪽은 종가를 기준으로 하여 차트를 분석했습니다 위의 차트가 정상성을 띄고있지 않다고 생각했고

![f10](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/d19636c9-46d2-41c3-a08d-3ffcb799338e)

한번 확인해보기위해서 Acf 차트를 그렸는데 점진적으로 감소하는 모습을 보여주고있습니다. 이건 비정상적 데이터의 특징이라고 볼 수 있습니다.
Acf 시계열 데이터의 자기상관을 나타내는 함수로 서 시차에 따른 이전 시점과의 상관관계를 보여주며
Pacf같은 경우는 시계열 데이터에서 시차에 따른 이전 시점과의 상관관계를 보여주지만 그 사이에 있는 다른 시차의 영향을 배제합니다.

![f11](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/2965d86f-32f7-4578-83e3-571032f8b118)

그 후에 시계열 데이터에서 추세와 계절성을 제거하거나 정상성을 만족시키기 위한 기법인 차분을 진행하여 시계열 데이터에서 일반적으로 추세나 계절성 불규칙성등의 패턴을 제거하거나 줄이는 작업을 진행하였습니다.
왼쪽의 로우 데이터가 원본 디퍼런스 데이터가 차분된 주식 종가 데이터입니다.
그 후에 차분된 데이터를 차트로 보여드린 장면이 오른쪽입니다. 노란색부분인데 비교적 일정해졌습니다. (현재 데이터랑 한시점 미룬 데이터의 차이점)
(Lag값은 40으로 뒀고 lag는 자신 데이터와 자신 바로 전 데이터의 코릴레이션이라고 합니다)

![f12](https://github.com/Kimtaewannnn/Kimtaewannnn.github.io/assets/133857370/a9104dcf-7974-4d58-80f5-3887fb9bfd00)

**오토아리마**는 자동적으로 아리마 모델의 파라미터를 선택하는 방법으로 자기회귀 , 차분 , 이동평균을 결합하여 데이터의 추세와 계절성을 반영합니다  
오토아리마 모델을 선택하여 2,1,2가 최적인 것을 찾았습니다.

P:모델의 시차 로그 수 , d:차분 시계열 데이터를 정상성으로 변환하기 위한 차분 횟수, q: ma모델의 이동평균 차수를 의미합니다.
2,1,2는 ar모델의 시차가 2 차분의 횟수가 1 ma 모델의 이동평균차수가 2인 모델을 의미하며 2개의이전 값과 2개의 이전 예측 오차를 사용하여 현재값을 예측하고 데이터를 한번 차분하여 정상성을 확보합니다.

그 후 데이터로 차트를 그려보면 오른쪽부분과 같이 나오는데 노란색 부분이 조금 아래로 기울어져있는것을 보아 주가가 조금 떨어질것을 예상했습니다.


